!function(e){var t={};function a(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=2)}([function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unroutableQueryStringKeys=t.subscribeQueryStringKey=t.referrerUrlQueryStringKey=t.marketingVariantQueryStringKey=t.marketingScreenVariantQueryStringKey=t.messageQueryStringKey=t.extensionInstalledQueryStringKey=t.authenticateQueryStringKey=t.deviceTypeQueryStringKey=t.clientTypeQueryStringKey=t.authServiceTokenQueryStringKey=t.appVersion=t.appReferralQueryStringKey=t.appPlatformQueryStringKey=t.createQueryString=t.parseQueryString=void 0,t.parseQueryString=function(e){return e?(e.startsWith("?")&&(e=e.substring(1)),e.split("&").reduce((e,t)=>{const a=t.split("=");return e[decodeURIComponent(a[0])]=decodeURIComponent(a[1]),e},{})):{}},t.createQueryString=function(e){if(e){const t=Object.keys(e).reduce((t,a)=>{const r=encodeURIComponent(a),n=e[a];return null==n?t.push(r):"string"==typeof n||"number"==typeof n||"boolean"==typeof n?t.push(r+"="+encodeURIComponent(n)):Array.isArray(n)&&n.forEach(e=>{t.push(r+"="+encodeURIComponent(e))}),t},[]);if(t.length)return"?"+t.join("&")}return""},t.appPlatformQueryStringKey="appPlatform",t.appReferralQueryStringKey="appReferral",t.appVersion="appVersion",t.authServiceTokenQueryStringKey="authServiceToken",t.clientTypeQueryStringKey="clientType",t.deviceTypeQueryStringKey="deviceType",t.authenticateQueryStringKey="authenticate",t.extensionInstalledQueryStringKey="extensionInstalled",t.messageQueryStringKey="message",t.marketingScreenVariantQueryStringKey="marketingScreenVariant",t.marketingVariantQueryStringKey="marketingVariant",t.referrerUrlQueryStringKey="referrerUrl",t.subscribeQueryStringKey="subscribe",t.unroutableQueryStringKeys=[t.appPlatformQueryStringKey,t.appReferralQueryStringKey,t.appVersion,t.clientTypeQueryStringKey,t.deviceTypeQueryStringKey,t.messageQueryStringKey,t.marketingScreenVariantQueryStringKey,t.marketingVariantQueryStringKey,t.referrerUrlQueryStringKey,t.subscribeQueryStringKey]},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createUrl=void 0;const r=a(0),n=[{protocol:"http",port:80},{protocol:"https",port:443}];function s(e){return e.startsWith("/")?e:"/"+e}t.createUrl=function(e,t,a){let i=e.protocol+"://"+e.host;if(null!=e.port){const t=n.filter(t=>t.protocol===e.protocol)[0];t&&t.port===e.port||(i+=":"+e.port)}return e.path&&(i+=s(e.path)),t&&(i+=s(t)),a&&(i+=r.createQueryString(a)),i}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=a(3),n=a(6),s=a(7),i=a(1),o=a(8),c=a(9),d=a(0),l=a(10),u=a(11),p=a(12),m=new l.default,g=new n.default({onDisplayPreferenceChanged:async e=>{await h.displayPreferenceChanged(e),await y.displayPreferenceChanged(e)},onUserSignedOut:async()=>{await h.userSignedOut()}}),h=new r.default({badgeApi:m,onGetDisplayPreference:()=>g.getDisplayPreference(),onGetDisplayPreferenceFromCache:()=>g.getDisplayPreferenceFromCache(),onGetExtensionOptions:()=>chrome.storage.local.get(p.extensionOptionsStorageQuery),onGetUserAccountFromCache:()=>g.getUserFromCache(),onChangeDisplayPreference:async e=>(await y.displayPreferenceChanged(e),g.changeDisplayPreference(e)),onGetUserArticle:(e,t)=>g.getUserArticle(e,t).then(async e=>(await y.articleUpdated({article:e.userArticle,isCompletionCommit:!1}),e)),onCommitReadState:(e,t,a)=>(console.log(`contentScriptApi.onCommitReadState (tabId: ${e})`),g.commitReadState(e,t).then(async e=>(await y.articleUpdated({article:e,isCompletionCommit:a}),e))),onGetComments:e=>g.getComments(e),onPostArticle:e=>g.postArticle(e).then(async e=>(await y.articlePosted(e),await y.articleUpdated({article:e.article,isCompletionCommit:!1}),e.comment&&await y.commentPosted(o.createCommentThread(e)),e)),onPostComment:e=>g.postComment(e).then(async e=>(await y.articleUpdated({article:e.article,isCompletionCommit:!1}),await y.commentPosted(e.comment),e)),onPostCommentAddendum:e=>g.postCommentAddendum(e).then(async e=>(await y.commentUpdated(e),e)),onPostCommentRevision:e=>g.postCommentRevision(e).then(async e=>(await y.commentUpdated(e),e)),onReadArticle:async(e,t)=>{const a=await g.getArticleDetails(t);console.log("article info: ",a);const r=await chrome.tabs.get(e);await f(r,a.url)},onRequestTwitterBrowserLinkRequestToken:()=>g.requestTwitterBrowserLinkRequestToken(),onReportArticleIssue:e=>g.reportArticleIssue(e),onSetStarred:e=>g.setStarred(e.articleId,e.isStarred).then(async e=>(await y.articleUpdated({article:e,isCompletionCommit:!1}),e)),onDeleteComment:e=>g.deleteComment(e).then(async e=>(await y.commentUpdated(e),e))}),y=new s.default({onArticleUpdated:async e=>{await h.articleUpdated(e)},onAuthServiceLinkCompleted:async e=>{await h.authServiceLinkCompleted(e)},onDisplayPreferenceChanged:async e=>{await g.displayPreferenceChanged(e),await h.displayPreferenceChanged(e)},onCommentPosted:async e=>{await h.commentPosted(e)},onCommentUpdated:async e=>{await h.commentUpdated(e)},onUserSignedIn:async e=>{await g.userUpdated(e.userAccount),await g.displayPreferenceChanged(e.displayPreference),await h.userSignedIn(e)},onUserSignedOut:async()=>{await g.userSignedOut(),await h.userSignedOut()},onUserUpdated:async e=>{await g.userUpdated(e),await h.userUpdated(e)},onReadArticle:async e=>{await async function(e){let t=await async function(){return new Promise((e,t)=>{chrome.tabs.query({active:!0,currentWindow:!0},t=>{e(t[0])})})}();t&&f(t,e)}(e.url)}});async function f(e,t){const a=await g.getDisplayPreferenceFromCache(),r=new URL(chrome.runtime.getURL("reader.html"));r.searchParams.append("url",t),a&&r.searchParams.append("theme",a.theme===u.DisplayTheme.Light?"light":"dark"),"safari-web-extension:"===r.protocol?await chrome.tabs.create({url:r.toString()}):await chrome.tabs.update(e.id,{url:r.toString()})}chrome.runtime.onInstalled.addListener(async e=>{console.log("[EventPage] installed, reason: "+e.reason);const t=["sessionKey",c.sessionIdCookieKey];for(const e of t){const t=await chrome.cookies.get({url:i.createUrl(Object({protocol:"https",host:"readup.org"})),name:e});"unspecified"===(null==t?void 0:t.sameSite)&&await chrome.cookies.set({url:i.createUrl(Object({protocol:"https",host:"readup.org"})),domain:t.domain,expirationDate:t.expirationDate,httpOnly:t.httpOnly,name:t.name,path:t.path,sameSite:"no_restriction",secure:t.secure,storeId:t.storeId,value:t.value})}await chrome.storage.local.set({debug:JSON.stringify(!1)}),await h.clearTabs(),await y.clearTabs(),await y.injectContentScripts();const a=await chrome.runtime.getPlatformInfo();try{const t=await g.logExtensionInstallation({arch:a.arch,installationId:(await chrome.storage.local.get("installationId")).installationId,os:a.os});if("install"===e.reason&&await chrome.tabs.create({url:i.createUrl(Object({protocol:"https",host:"readup.org"}),t.redirectPath,{[d.extensionInstalledQueryStringKey]:null})}),!t.installationId)return;chrome.runtime.setUninstallURL(i.createUrl(Object({protocol:"https",host:"readup.org"}),"/extension/uninstall",{installationId:t.installationId})),await chrome.storage.local.set({installationId:t.installationId})}catch(e){console.log("[EventPage] error logging installation"),e&&console.log(e)}}),chrome.runtime.onStartup.addListener(async()=>{console.log("[EventPage] startup"),await h.clearTabs(),await y.clearTabs(),await y.injectContentScripts()}),chrome.action.onClicked.addListener(async e=>{e.url&&(e.url.startsWith(`chrome-extension://${chrome.runtime.id}/reader`)?await chrome.tabs.goBack(e.id):e.url.startsWith(i.createUrl(Object({protocol:"https",host:"readup.org"})))?await chrome.scripting.executeScript({target:{tabId:e.id},func:()=>{window.reallyreadit&&window.reallyreadit.alertContentScript?window.reallyreadit.alertContentScript.isActive||window.reallyreadit.alertContentScript.display():(window.reallyreadit=Object.assign(window.reallyreadit,{alertContentScript:{alertContent:"Press the Readup button when you're on an article web page."}}),chrome.runtime.sendMessage({from:"contentScriptInitializer",to:"eventPage",type:"injectAlert"}))}}):await f(e,e.url))}),chrome.runtime.onMessage.addListener((e,t,a)=>{if("contentScriptInitializer"!==e.from||"eventPage"!==e.to)return!0;switch(e.type){case"injectAlert":chrome.scripting.executeScript({target:{tabId:t.tab.id},files:["/content-scripts/alert/bundle.js"]});break;case"injectReader":chrome.scripting.executeScript({target:{tabId:t.tab.id},files:["/content-scripts/reader/bundle.js"]})}return a(),!1})},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=a(4),n=a(5);t.default=class{constructor(e){this._badge=e.badgeApi,chrome.runtime.onMessage.addListener((t,a,s)=>{var i,o;if("eventPage"!==t.to||"readerContentScript"!==t.from)return!0;switch("loadingAnimationTick"!==t.type&&console.log(`[ReaderApi] received ${t.type} message from tab # ${null===(i=a.tab)||void 0===i?void 0:i.id}`),t.type){case"getDisplayPreference":return r.createMessageResponseHandler(e.onGetDisplayPreference(),s),!0;case"getDisplayPreferenceFromCache":return r.createMessageResponseHandler(e.onGetDisplayPreferenceFromCache(),s),!0;case"getExtensionOptions":return r.createMessageResponseHandler(e.onGetExtensionOptions(),s),!0;case"getUserAccountFromCache":return r.createMessageResponseHandler(e.onGetUserAccountFromCache(),s),!0;case"changeDisplayPreference":return r.createMessageResponseHandler((async()=>(await this.sendMessageToOtherTabs(a.tab.id,{type:"displayPreferenceChanged",data:t.data}),await e.onChangeDisplayPreference(t.data)))(),s),!0;case"loadingAnimationTick":(async()=>{const e=t.data;0!==e?await this._badge.setLoading(a.tab.id,e):await this._badge.setDefault(a.tab.id)})();break;case"registerPage":return r.createMessageResponseHandler((async()=>{await this.setTab({articleId:null,id:a.tab.id})})(),s),!0;case"getUserArticle":return r.createMessageResponseHandler((async()=>{try{const r=await e.onGetUserArticle(a.tab.id,t.data);await this.setTab({articleId:r.userArticle.id,id:a.tab.id});const s=await this.getTabs();for(const e of s)e.articleId===r.userArticle.id&&(await this._badge.setReading(e.id,r.userArticle),await chrome.action.setTitle({tabId:e.id,title:n.calculateEstimatedReadTime(r.userArticle.wordCount)+" min. read"}));return r}catch(e){throw await this._badge.setDefault(a.tab.id),e}})(),s),!0;case"commitReadState":return r.createMessageResponseHandler((async()=>{const r=await e.onCommitReadState(a.tab.id,t.data.commitData,t.data.isCompletionCommit),n=await this.getTabs();for(const e of n)e.articleId===r.id&&await this._badge.setReading(e.id,r);return r})(),s),!0;case"unregisterPage":const i=null===(o=null==a?void 0:a.tab)||void 0===o?void 0:o.id;null!=i&&this.removeTab(i);break;case"closeWindow":chrome.windows.remove(t.data,()=>{chrome.runtime.lastError&&console.log("[ReaderApi] error closing window, message: "+chrome.runtime.lastError.message)});break;case"getComments":return r.createMessageResponseHandler(e.onGetComments(t.data),s),!0;case"hasWindowClosed":return r.createMessageResponseHandler(new Promise((e,a)=>{chrome.windows.get(t.data,t=>{chrome.runtime.lastError&&console.log("[ReaderApi] error getting window, message: "+chrome.runtime.lastError.message),e(!t)})}),s),!0;case"openWindow":const c=t.data;return r.createMessageResponseHandler(new Promise((e,t)=>{chrome.windows.create({type:"popup",url:c.url,width:c.width,height:c.height,focused:!0},a=>{if(chrome.runtime.lastError)return console.log("[ReaderApi] error opening window, message: "+chrome.runtime.lastError.message),void t(chrome.runtime.lastError);e(a.id)})}),s),!0;case"postArticle":return r.createMessageResponseHandler(e.onPostArticle(t.data),s),!0;case"postComment":return r.createMessageResponseHandler(e.onPostComment(t.data),s),!0;case"postCommentAddendum":return r.createMessageResponseHandler(e.onPostCommentAddendum(t.data),s),!0;case"postCommentRevision":return r.createMessageResponseHandler(e.onPostCommentRevision(t.data),s),!0;case"readArticle":return r.createMessageResponseHandler(e.onReadArticle(a.tab.id,t.data),s),!0;case"reportArticleIssue":return r.createMessageResponseHandler(e.onReportArticleIssue(t.data),s),!0;case"requestTwitterBrowserLinkRequestToken":return r.createMessageResponseHandler(e.onRequestTwitterBrowserLinkRequestToken(),s),!0;case"setStarred":return r.createMessageResponseHandler(e.onSetStarred(t.data),s),!0;case"deleteComment":return r.createMessageResponseHandler(e.onDeleteComment(t.data),s),!0}return s(),!1})}async getTabs(){return(await chrome.storage.local.get("readerTabs")).readerTabs||[]}async setTabs(e){await chrome.storage.local.set({readerTabs:e})}async setTab(e){let t=await this.getTabs();t=t.filter(t=>t.id!==e.id),t.push(e),await this.setTabs(t)}async removeTab(e){const t=await this.getTabs();t.some(t=>t.id===e)&&await this.setTabs(t.filter(t=>t.id!==e))}async broadcastMessage(e,t){for(const a of e){console.log(`[ReaderApi] sending ${t.type} message to tab # ${a.id}`);try{await chrome.tabs.sendMessage(a.id,t)}catch(e){console.log(`[ReaderApi] error sending message to tab # ${a.id}, message: ${e}`),await this.removeTab(a.id)}}}async sendMessageToAllTabs(e){await this.broadcastMessage(await this.getTabs(),e)}async sendMessageToOtherTabs(e,t){const a=await this.getTabs();await this.broadcastMessage(a.filter(t=>t.id!==e),t)}async sendMessageToArticleTabs(e,t){const a=await this.getTabs();await this.broadcastMessage(a.filter(t=>t.articleId===e),t)}async articleUpdated(e){await this.sendMessageToArticleTabs(e.article.id,{type:"articleUpdated",data:e})}async authServiceLinkCompleted(e){await this.sendMessageToAllTabs({type:"authServiceLinkCompleted",data:e})}async clearTabs(){await this.setTabs([])}async commentPosted(e){await this.sendMessageToArticleTabs(e.articleId,{type:"commentPosted",data:e})}async commentUpdated(e){await this.sendMessageToArticleTabs(e.articleId,{type:"commentUpdated",data:e})}async displayPreferenceChanged(e){await this.sendMessageToAllTabs({type:"displayPreferenceChanged",data:e})}async userSignedIn(e){await this.sendMessageToAllTabs({type:"userSignedIn",data:e})}async userSignedOut(){await this.sendMessageToAllTabs({type:"userSignedOut"});const e=await this.getTabs();for(const t of e)await this._badge.setDefault(t.id)}async userUpdated(e){await this.sendMessageToAllTabs({type:"userUpdated",data:e})}}},function(e,t,a){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.createMessageResponseHandler=t.isSuccessResponse=t.ResponseType=void 0,function(e){e[e.Success=0]="Success",e[e.Error=1]="Error"}(r=t.ResponseType||(t.ResponseType={})),t.isSuccessResponse=function(e){return(null==e?void 0:e.type)===r.Success},t.createMessageResponseHandler=function(e,t){e.then(e=>{t({value:e,type:r.Success})}).catch(e=>{e instanceof Error&&(e={message:e.message,name:e.name}),t({error:e,type:r.Error})})}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.calculateEstimatedReadTime=void 0,t.calculateEstimatedReadTime=function(e){return Math.max(1,Math.floor(e/184))}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=a(1),n=a(0);t.default=class{constructor(e){this._onDisplayPreferenceChanged=e.onDisplayPreferenceChanged,this._onUserSignedOut=e.onUserSignedOut}async getDisplayPreferenceFromStorage(){return(await chrome.storage.local.get("displayPreference")).displayPreference}async getUserFromStorage(){return(await chrome.storage.local.get("user")).user}async fetchJson(e){const t=this;return new Promise((a,s)=>{const i=r.createUrl(Object({protocol:"https",host:"api.readup.org"}),e.path);let o;o="POST"===e.method?new Request(i,{method:"POST",credentials:"include",headers:Object.assign(Object.assign({},{"X-Readup-Client":"web/extension@8.0.0"}),{"Content-Type":"application/json"}),body:JSON.stringify(e.data)}):new Request(`${i}${n.createQueryString(e.data)}`,{credentials:"include",headers:Object.assign({},{"X-Readup-Client":"web/extension@8.0.0"})}),fetch(o).then(e=>{const t=e.headers.get("Content-Type");return(null==t?void 0:t.startsWith("application/json"))||(null==t?void 0:t.startsWith("application/problem+json"))?e.json().then(t=>({response:e,responseText:void 0,responseObject:t})):e.text().then(t=>({response:e,responseObject:void 0,responseText:t}))}).then(async({response:e,responseText:r,responseObject:n})=>{200===e.status?a(n||null):(401===e.status&&(console.log("[ServerApi] user signed out (received 401 response from API server)"),await t.userSignedOut(),t._onUserSignedOut()),s(n||["ServerApi fetch response. Status: "+e.status+" Status text: "+e.statusText+" Response text: "+r]))}).catch(()=>{s(["ServerApi fetch error"])})})}getUserArticle(e,t){return this.fetchJson({method:"POST",path:"/Extension/GetUserArticle",data:t,id:e})}getArticleDetails(e){return this.fetchJson({method:"GET",path:"/Articles/Details",data:{slug:e}})}getComments(e){return this.fetchJson({method:"GET",path:"/Articles/ListComments",data:{slug:e}})}postArticle(e){return this.fetchJson({method:"POST",path:"/Social/Post",data:e})}postComment(e){return this.fetchJson({method:"POST",path:"/Social/Comment",data:e})}postCommentAddendum(e){return this.fetchJson({method:"POST",path:"/Social/CommentAddendum",data:e})}postCommentRevision(e){return this.fetchJson({method:"POST",path:"/Social/CommentRevision",data:e})}deleteComment(e){return this.fetchJson({method:"POST",path:"/Social/CommentDeletion",data:e})}commitReadState(e,t){return this.fetchJson({method:"POST",path:"/Extension/CommitReadState",data:t})}async isAuthenticated(){return null!=await this.getUserFromCache()}async getUserFromCache(){return this.getUserFromStorage()}rateArticle(e,t){return this.fetchJson({method:"POST",path:"/Articles/Rate",data:{articleId:e,score:t}})}reportArticleIssue(e){return this.fetchJson({method:"POST",path:"/Analytics/ArticleIssueReport",data:e})}requestTwitterBrowserLinkRequestToken(){return this.fetchJson({method:"POST",path:"/Auth/TwitterBrowserLinkRequest"})}setStarred(e,t){return this.fetchJson({method:"POST",path:"/Extension/SetStarred",data:{articleId:e,isStarred:t}})}logExtensionInstallation(e){return this.fetchJson({method:"POST",path:"/Extension/Install",data:e})}async userSignedOut(){await chrome.storage.local.set({user:null,displayPreference:null})}async userUpdated(e){await chrome.storage.local.set({user:e||null})}async getDisplayPreferenceFromCache(){return await this.getDisplayPreferenceFromStorage()}async getDisplayPreference(){return this.fetchJson({method:"GET",path:"/UserAccounts/DisplayPreference"}).then(async e=>(await this.displayPreferenceChanged(e),console.log("[ServerApi] display preference changed"),this._onDisplayPreferenceChanged(e),e)).catch(()=>(console.log("[ServerApi] error fetching display preference"),null))}async displayPreferenceChanged(e){await chrome.storage.local.set({displayPreference:e})}async changeDisplayPreference(e){return await this.displayPreferenceChanged(e),await this.isAuthenticated()?this.fetchJson({method:"POST",path:"/UserAccounts/DisplayPreference",data:e}):e}}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){chrome.runtime.onMessage.addListener((t,a,r)=>{var n,s;if("eventPage"!==t.to||"webAppContentScript"!==t.from)return!0;switch(console.log(`[WebAppApi] received ${t.type} message from tab # ${null===(n=a.tab)||void 0===n?void 0:n.id}`),t.type){case"articleUpdated":e.onArticleUpdated(t.data);break;case"authServiceLinkCompleted":e.onAuthServiceLinkCompleted(t.data);break;case"commentPosted":e.onCommentPosted(t.data);break;case"commentUpdated":e.onCommentUpdated(t.data);break;case"displayPreferenceChanged":e.onDisplayPreferenceChanged(t.data);break;case"registerPage":this.addTab(a.tab.id);break;case"readArticle":e.onReadArticle(t.data);break;case"unregisterPage":this.removeTab(null===(s=null==a?void 0:a.tab)||void 0===s?void 0:s.id);break;case"userSignedIn":e.onUserSignedIn(t.data);break;case"userSignedOut":e.onUserSignedOut();break;case"userUpdated":e.onUserUpdated(t.data)}return r(),!1})}async getTabIds(){return(await chrome.storage.local.get("webAppTabs")).webAppTabs||[]}async setTabIds(e){await chrome.storage.local.set({webAppTabs:e})}async addTab(e){const t=await this.getTabIds();t.includes(e)||(t.push(e),await this.setTabIds(t))}async broadcastMessage(e){const t=await this.getTabIds();for(const a of t){console.log(`[WebAppApi] sending ${e.type} message to tab # ${a}`);try{await chrome.tabs.sendMessage(a,e)}catch(e){console.log(`[WebAppApi] error sending message to tab # ${a}, message: ${e}`),await this.removeTab(a)}}}async removeTab(e){const t=await this.getTabIds();t.includes(e)&&await this.setTabIds(t.filter(t=>t!==e))}async articlePosted(e){await this.broadcastMessage({type:"articlePosted",data:e})}async articleUpdated(e){await this.broadcastMessage({type:"articleUpdated",data:e})}async clearTabs(){await this.setTabIds([])}async commentPosted(e){await this.broadcastMessage({type:"commentPosted",data:e})}async commentUpdated(e){await this.broadcastMessage({type:"commentUpdated",data:e})}async displayPreferenceChanged(e){await this.broadcastMessage({type:"displayPreferenceChanged",data:e})}async injectContentScripts(){var e;try{const t=await chrome.tabs.query({url:"https://readup.org/*",status:"complete"});for(const a of t){if(!(null===(e=a.url)||void 0===e?void 0:e.startsWith("https://readup.org/")))return;console.log("[WebAppApi] injecting content script into tab # "+a.id),await chrome.scripting.executeScript({target:{tabId:a.id},files:["/content-scripts/web-app/bundle.js"]})}}catch(e){console.log("[WebAppApi] error querying tabs")}}async userUpdated(e){await this.broadcastMessage({type:"userUpdated",data:e})}}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createCommentThread=void 0,t.createCommentThread=function(e){return{id:e.comment&&e.comment.id||"",dateCreated:e.date,text:e.comment&&e.comment.text||"",addenda:e.comment&&e.comment.addenda||[],articleId:e.article.id,articleTitle:e.article.title,articleSlug:e.article.slug,userAccount:e.userName,badge:e.badge,isAuthor:!1,parentCommentId:null,dateDeleted:e.dateDeleted,children:[]}}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sessionIdCookieKey=t.extensionVersionCookieKey=t.extensionInstallationRedirectPathCookieKey=void 0,t.extensionInstallationRedirectPathCookieKey="extensionInstallationRedirectPath",t.extensionVersionCookieKey="extensionVersion",t.sessionIdCookieKey="sessionId"},function(e,t,a){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Default="#555555",e.Read="#32CD32",e.Unread="#A9A9A9"}(r||(r={}));t.default=class{constructor(){this._loadingAnimationFrameCount=5}async setDefault(e){await chrome.action.setBadgeBackgroundColor({color:r.Default,tabId:e}),await chrome.action.setBadgeText({tabId:e,text:""})}async setLoading(e,t){t%=this._loadingAnimationFrameCount;let a="";for(let e=0;e<this._loadingAnimationFrameCount-1;e++)a+=e===t?".":String.fromCharCode(8200);await chrome.action.setBadgeText({tabId:e,text:a})}async setReading(e,t){console.log(`[BrowserActionBadgeApi] setting progress at ${Math.floor(t.percentComplete)}% for tab # ${e}`),await chrome.action.setBadgeBackgroundColor({color:t.isRead?r.Read:r.Unread,tabId:e}),await chrome.action.setBadgeText({tabId:e,text:Math.floor(t.percentComplete)+"%"})}}},function(e,t,a){"use strict";var r;function n(){return window.matchMedia("(prefers-color-scheme: dark)").matches?r.Dark:r.Light}Object.defineProperty(t,"__esModule",{value:!0}),t.getDisplayPreferenceChangeMessage=t.getClientDefaultDisplayPreference=t.getClientPreferredColorScheme=t.areEqual=t.DisplayTheme=void 0,function(e){e[e.Light=1]="Light",e[e.Dark=2]="Dark"}(r=t.DisplayTheme||(t.DisplayTheme={})),t.areEqual=function(e,t){return e.hideLinks===t.hideLinks&&e.textSize===t.textSize&&e.theme===t.theme},t.getClientPreferredColorScheme=n,t.getClientDefaultDisplayPreference=function(){return{hideLinks:!0,textSize:1,theme:n()}},t.getDisplayPreferenceChangeMessage=function(e,t){let a;return t.hideLinks!==e.hideLinks?a="Links "+(t.hideLinks?"Disabled":"Enabled"):t.textSize!==e.textSize?a="Text Size "+(t.textSize>e.textSize?"Increased":"Decreased"):t.theme!==e.theme&&(a=(t.theme===r.Dark?"Dark":"Light")+" Theme Enabled"),a}},function(e,t,a){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.extensionOptionsStorageQuery=t.ExtensionOptionKey=void 0,function(e){e.StarOnSave="extOptionStarOnSave"}(r=t.ExtensionOptionKey||(t.ExtensionOptionKey={})),t.extensionOptionsStorageQuery={[r.StarOnSave]:!1}}]);