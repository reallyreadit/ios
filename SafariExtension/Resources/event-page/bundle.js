!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createUrl=void 0;var n=r(1),o=[{protocol:"http",port:80},{protocol:"https",port:443}];function i(e){return e.startsWith("/")?e:"/"+e}t.createUrl=function(e,t,r){var a=e.protocol+"://"+e.host;if(null!=e.port){var s=o.filter((function(t){return t.protocol===e.protocol}))[0];s&&s.port===e.port||(a+=":"+e.port)}return e.path&&(a+=i(e.path)),t&&(a+=i(t)),r&&(a+=n.createQueryString(r)),a}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unroutableQueryStringKeys=t.referrerUrlQueryStringKey=t.marketingVariantQueryStringKey=t.marketingScreenVariantQueryStringKey=t.subscribeQueryStringKey=t.messageQueryStringKey=t.extensionInstalledQueryStringKey=t.extensionAuthQueryStringKey=t.deviceTypeQueryStringKey=t.clientTypeQueryStringKey=t.authServiceTokenQueryStringKey=t.appReferralQueryStringKey=t.createQueryString=t.parseQueryString=void 0,t.parseQueryString=function(e){return e?(e.startsWith("?")&&(e=e.substring(1)),e.split("&").reduce((function(e,t){var r=t.split("=");return e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]),e}),{})):{}},t.createQueryString=function(e){if(e){var t=Object.keys(e).reduce((function(t,r){var n=encodeURIComponent(r),o=e[r];return null==o?t.push(n):"string"==typeof o||"number"==typeof o||"boolean"==typeof o?t.push(n+"="+encodeURIComponent(o)):Array.isArray(o)&&o.forEach((function(e){t.push(n+"="+encodeURIComponent(e))})),t}),[]);if(t.length)return"?"+t.join("&")}return""},t.appReferralQueryStringKey="appReferral",t.authServiceTokenQueryStringKey="authServiceToken",t.clientTypeQueryStringKey="clientType",t.deviceTypeQueryStringKey="deviceType",t.extensionAuthQueryStringKey="extensionAuth",t.extensionInstalledQueryStringKey="extensionInstalled",t.messageQueryStringKey="message",t.subscribeQueryStringKey="subscribe",t.marketingScreenVariantQueryStringKey="marketingScreenVariant",t.marketingVariantQueryStringKey="marketingVariant",t.referrerUrlQueryStringKey="referrerUrl",t.unroutableQueryStringKeys=[t.appReferralQueryStringKey,t.authServiceTokenQueryStringKey,t.clientTypeQueryStringKey,t.deviceTypeQueryStringKey,t.extensionAuthQueryStringKey,t.extensionInstalledQueryStringKey,t.messageQueryStringKey,t.subscribeQueryStringKey,t.marketingScreenVariantQueryStringKey,t.marketingVariantQueryStringKey,t.referrerUrlQueryStringKey]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),o=r(4),i=r(0),a=r(7),s=r(8),c=r(9),u=new a.default,l=new n.default,p=new o.default;function d(e,t){chrome.tabs.executeScript(e,{code:"if (!window.reallyreadit?.alertContentScript) { window.reallyreadit = { ...window.reallyreadit, alertContentScript: { alertContent: '"+t+"' } }; chrome.runtime.sendMessage({ from: 'contentScriptInitializer', to: 'eventPage', type: 'injectAlert' }); } else if (!window.reallyreadit.alertContentScript.isActive) { window.reallyreadit.alertContentScript.display(); }"})}function f(e){var t=i.createUrl(Object({protocol:"https",host:"readup.com"}),"/download");d(e,'Download the Readup app to continue: <a href="'+t+'">'+t+"</a>.")}chrome.runtime.onInstalled.addListener((function(e){console.log("[EventPage] installed, reason: "+e.reason),localStorage.removeItem("parseMode"),localStorage.removeItem("showOverlay"),localStorage.removeItem("newReplyNotification"),localStorage.removeItem("sourceRules"),localStorage.removeItem("articles"),localStorage.removeItem("tabs"),localStorage.removeItem("displayedNotifications"),localStorage.removeItem("displayPreference"),localStorage.removeItem("blacklist"),localStorage.removeItem("user"),localStorage.removeItem("contentParserScript"),localStorage.removeItem("contentParserVersion"),p.clearTabs(),p.injectContentScripts(),chrome.runtime.getPlatformInfo((function(e){l.logExtensionInstallation({arch:e.arch,installationId:localStorage.getItem("installationId"),os:e.os}).then((function(e){e.installationId&&(chrome.runtime.setUninstallURL(i.createUrl(Object({protocol:"https",host:"readup.com"}),"/extension/uninstall",{installationId:e.installationId})),localStorage.setItem("installationId",e.installationId))})).catch((function(e){console.log("[EventPage] error logging installation"),e&&console.log(e)}))}))})),chrome.runtime.onStartup.addListener((function(){console.log("[EventPage] startup"),p.clearTabs(),p.injectContentScripts()})),chrome.browserAction.onClicked.addListener((function(e){if(e.url)if(e.url.startsWith(i.createUrl(Object({protocol:"https",host:"readup.com"}))))d(e.id,"Press the Readup button when you're on an article web page.");else if(c.ignoreList.some((function(t){return t.test(e.url)})))d(e.id,"No article detected on this web page.");else{u.setLoading();var t={type:s.NativeMessageType.ReadArticle,data:{url:e.url}};chrome.runtime.sendNativeMessage("it.reallyread.mobile.browser_extension_app",t,(function(t){if(u.setDefault(),chrome.runtime.lastError)return console.log("[EventPage] Error sending native message."),void f(e.id);console.log("[EventPage] Received native message response:"),console.log(t),(null==t?void 0:t.succeeded)||f(e.id)}))}})),chrome.runtime.onMessage.addListener((function(e,t){if("contentScriptInitializer"===e.from&&"eventPage"===e.to)switch(e.type){case"injectAlert":return void chrome.tabs.executeScript(t.tab.id,{file:"/content-scripts/alert/bundle.js"})}}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(1);function i(e,t){e.setRequestHeader("X-Readup-Client","web/extension@6.0.0")}var a=function(){function e(){}return e.prototype.fetchJson=function(e){return new Promise((function(t,r){var a=new XMLHttpRequest,s=n.createUrl(Object({protocol:"https",host:"api.readup.com"}),e.path);a.withCredentials=!0,a.addEventListener("load",(function(){var e,n=this.getResponseHeader("Content-Type");((null==n?void 0:n.startsWith("application/json"))||(null==n?void 0:n.startsWith("application/problem+json")))&&(e=JSON.parse(this.responseText)),200===this.status?t(e||null):(401===this.status&&console.log("[ServerApi] user signed out (received 401 response from API server)"),r(e||["ServerApi XMLHttpRequest load event. Status: "+this.status+" Status text: "+this.statusText+" Response text: "+this.responseText]))})),a.addEventListener("error",(function(){r(["ServerApi XMLHttpRequest error event"])})),"POST"===e.method?(a.open(e.method,s),i(a),a.setRequestHeader("Content-Type","application/json"),a.send(JSON.stringify(e.data))):(a.open(e.method,s+o.createQueryString(e.data)),i(a),a.send())}))},e.prototype.logExtensionInstallation=function(e){return this.fetchJson({method:"POST",path:"/Extension/Install",data:e})},e}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(5),o=function(){function e(){var e=this;this._tabs=new n.default("webAppTabs",[],"localStorage"),chrome.runtime.onMessage.addListener((function(t,r){var n;if("eventPage"===t.to&&"webAppContentScript"===t.from)switch(console.log("[WebAppApi] received "+t.type+" message from tab # "+(null===(n=r.tab)||void 0===n?void 0:n.id)),t.type){case"registerPage":e.addTab(r.tab.id);break;case"unregisterPage":e.removeTab(r.tab.id)}return!1}))}return e.prototype.addTab=function(e){var t=this._tabs.get();t.includes(e)||(t.push(e),this._tabs.set(t))},e.prototype.removeTab=function(e){var t=this._tabs.get();t.includes(e)&&(t.splice(t.indexOf(e),1),this._tabs.set(t))},e.prototype.broadcastMessage=function(e){var t=this;this._tabs.get().forEach((function(r){console.log("[WebAppApi] sending "+e.type+" message to tab # "+r),chrome.tabs.sendMessage(r,e,(function(){chrome.runtime.lastError&&(console.log("[WebAppApi] error sending message to tab # "+r+", message: "+chrome.runtime.lastError.message),t.removeTab(r))}))}))},e.prototype.clearTabs=function(){this._tabs.clear()},e.prototype.injectContentScripts=function(){chrome.tabs.query({url:"https://readup.com/*",status:"complete"},(function(e){chrome.runtime.lastError?console.log("[WebAppApi] error querying tabs"):e.forEach((function(e){var t;(null===(t=e.url)||void 0===t?void 0:t.startsWith("https://readup.com/"))&&(console.log("[WebAppApi] injecting content script into tab # "+e.id),chrome.tabs.executeScript(e.id,{file:"/content-scripts/web-app/bundle.js"}))}))}))},e}();t.default=o},function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,r,n){return void 0===n&&(n="localStorage"),e.call(this,t,r,n)||this}return o(t,e),t.prototype.get=function(){return this._read()},t.prototype.set=function(e){this._write(e)},t}(r(6).default);t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r){var n=this;if(void 0===r&&(r="localStorage"),this._eventListeners=[],this._defaultValue=t,function(e){void 0===e&&(e="localStorage");try{var t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==t.length}}(r)){var o;switch(r){case"localStorage":o=localStorage;break;case"sessionStorage":o=sessionStorage}this._storage={read:function(){return JSON.parse(o.getItem(e))},write:function(t){o.setItem(e,JSON.stringify(t))}},this._onStorage=function(t){t.key===e&&n._eventListeners.forEach((function(e){e(JSON.parse(t.oldValue),JSON.parse(t.newValue))}))};try{null==this._read()&&this.clear()}catch(e){this.clear()}}else{var i;this._storage={read:function(){return i},write:function(e){i=e}}}}return e.prototype._read=function(){return this._storage.read()},e.prototype._write=function(e){this._storage.write(e)},e.prototype.clear=function(){this._write(this._defaultValue)},e.prototype.addEventListener=function(e){0===this._eventListeners.length&&window.addEventListener("storage",this._onStorage),this._eventListeners.push(e)},e.prototype.removeEventListener=function(e){this._eventListeners.splice(this._eventListeners.findIndex((function(t){return t===e})),1),0===this._eventListeners.length&&window.removeEventListener("storage",this._onStorage)},e}();t.default=n},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Default="#555555"}(n||(n={}));var o=function(){function e(){this._animations=[]}return e.prototype.cancelAnimation=function(e){var t=this.getAnimation(e);t&&(console.log("[BrowserActionBadgeApi] cancelling loading animation for tab # "+e),clearInterval(t.interval),this._animations.splice(this._animations.indexOf(t),1))},e.prototype.getAnimation=function(e){return this._animations.find((function(t){return t.tabId===e}))},e.prototype.setDefault=function(e){void 0===e&&(e=null),this.cancelAnimation(e),chrome.browserAction.setBadgeBackgroundColor({color:n.Default,tabId:e}),chrome.browserAction.setBadgeText({tabId:e,text:""})},e.prototype.setLoading=function(e){void 0===e&&(e=null),this.getAnimation(e)||(console.log("[BrowserActionBadgeApi] creating loading animation for tab # "+e),this._animations.push(function(e){var t=0;return chrome.browserAction.setBadgeBackgroundColor({color:n.Default,tabId:e}),{interval:window.setInterval((function(){for(var r="",n=0;n<4;n++)r+=n===t?".":String.fromCharCode(8200);chrome.browserAction.setBadgeText({tabId:e,text:r}),t=++t%5}),150),tabId:e}}(e)))},e}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NativeMessageType=void 0,function(e){e.ReadArticle="readArticle"}(t.NativeMessageType||(t.NativeMessageType={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ignoreList=void 0,t.ignoreList=[/^https:\/\/www\.fastmail\.com\//,/^https:\/\/docs\.google\.com\//,/^https:\/\/mail\.google\.com\//,/^https:\/\/.+\.substack\.com\/$/]}]);